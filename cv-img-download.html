<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: xwMOOC 고생대 프로젝트</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    
      ga('create', 'UA-59802572-17', 'auto');
      ga('send', 'pageview');
    
    </script>
  </head>
  <body class="lesson">
    <div class="container card">
      <div class="banner">
        <a href="http://software-carpentry.org" title="Software Carpentry">
          <img alt="Software Carpentry banner" src="img/software-carpentry-banner.png" />
        </a>
      </div>
      <article>
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
                    <a href="index.html"><h1 class="title">xwMOOC 고생대 프로젝트</h1></a>
          <h2 class="subtitle">작업 이미지 긁어오기</h2>
          <p>기계학습 모형을 개발할 때 이미지 데이터가 대량으로 필요하다. <a href="http://image-net.org/">이미지넷</a>이 연구용으로 작업하기 좋은 데이터를 대량으로 손쉽게 구할 수 있는 통로이기도 하다. 인터넷에서 연구용으로 이미지 데이터를 준비하는 방법을 살펴보자.</p>
<p><img src="fig/cv-img-download.png" alt="이미지 다운로드 작업흐름" width="60%"></p>
<h2 id="다운로드-대상파일-선정">1. 다운로드 대상파일 선정</h2>
<p><a href="http://image-net.org/">이미지넷</a>에 다양한 분류에 따라 수천장의 이미지가 있는 경우도 있다. 작성한 코드가 정상작동하는지 확인하려는 목적이기 때문에 분류체계에 따라 가장 적은 이미지를 분류집단을 찾아야 하는데, 현재 시간 기준(’16년5월26일) <code>Misc(20400)</code> → <code>tea-like drink</code> 에 23장 차관련 이미지가 있다.</p>
<p><a href="http://image-net.org/api/text/imagenet.synset.geturls?wnid=n07933530" class="uri">http://image-net.org/api/text/imagenet.synset.geturls?wnid=n07933530</a></p>
<p>상기 url에 포함된 이미지 파일 링크는 다음과 같다.</p>
<ol style="list-style-type: decimal">
<li>http://open.salon.com/files/tea_cup_small1259088246.jpg</li>
<li>http://www.teageek.net/Images/TeaTasting3.jpg</li>
<li>http://farm1.static.flickr.com/29/45497721_fb90fefa74.jpg</li>
<li>http://mortalcore.com/wp-content/uploads/2009/06/istock_000005851440xsmall-300x199.jpg</li>
<li>http://c2.api.ning.com/files/ldu*IIBKr68CKtLHAYP3DpsspxMhWj-e8PIBGotCENVGjIFVF6e1yFAvqiqZhwg1. vwjG50f9k5n9GOUVKG4xUP8x-kidLy12V/turkish_coffee.jpg</li>
<li>http://www.health-outlook.com/wp-content/uploads/2009/03/tea.jpg</li>
<li>http://blog.hotelclub.com/wp-content/uploads/2008/09/hot-buttered-rum.jpg</li>
<li>http://ndn3.newsweek.com/media/14/080402_GreenTea_vl-vertical.jpg</li>
<li>http://www.green-tea-expert.com/images/green-tea2.jpg</li>
<li>http://www.agriculturalproductsindia.com/images/tea1.jpg</li>
<li>http://www.teaworld.co.uk/images/teaLemon123.jpg</li>
<li>http://farm3.static.flickr.com/2342/2445546884_3b08d9c25a_o.jpg</li>
<li>http://farm4.static.flickr.com/3220/3105599324_0049f02d87.jpg</li>
<li>http://static.squidoo.com/resize/squidoo_images/-1/lens6175262_1249329862Mugicha.jpg</li>
<li>http://www.fresnodog.com/images/whitetea.jpg</li>
<li>http://thefeministbreeder.typepad.com/.a/6a00e54ed890f88833011168682476970c-200wi</li>
<li>http://www.theteahouse.com/topics1.jpg</li>
<li>http://farm4.static.flickr.com/3249/3286589010_2cbc20d1c5_o.jpg</li>
<li>http://i30.tinypic.com/117sojt.jpg</li>
<li>http://farm1.static.flickr.com/1/546852_90153feb56.jpg</li>
<li>http://teaguide.files.wordpress.com/2009/08/customblendimage.jpg</li>
<li>http://4.bp.blogspot.com/_3DCs5bz7mdM/Sm0ck3s5r5I/AAAAAAAAB4s/KjfHq35beQ0/s320/1. Camellia+and+teacup.jpg</li>
<li>http://img.tradeindia.com/fp/thumb/1/385/188.jpg</li>
</ol>
<h2 id="파일-다운로드-파이썬-코드-작성-sentdex-urllib">2. 파일 다운로드 파이썬 코드 작성 <a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></h2>
<p>파이썬3 <code>urllib</code> 라이브러리를 사용해서 이미지 파일을 다운로드한다.</p>
<ol style="list-style-type: decimal">
<li>다운로드할 이미지를 품고있는 이미지넷 url을 확인한다.</li>
<li>다운로드할 이미지를 저장할 디렉토리를 생성한다 – 존재하지 않을 경우 디렉토리를 <code>tea</code> 이름으로 새로 생성한다.</li>
<li><code>urllib.request.urlretrieve</code> 메쏘드를 사용해서 인덱스 숫자를 파일명으로 확장자를 <code>.jpg</code>로 하여 다운로드한다.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">import</span> urllib.request
<span class="im">import</span> os

<span class="kw">def</span> save_images_from_image_net():
    tea_images_link <span class="op">=</span> <span class="st">&#39;http://image-net.org/api/text/imagenet.synset.geturls?wnid=n07933530&#39;</span>
    tea_image_urls <span class="op">=</span> urllib.request.urlopen(tea_images_link).read().decode()

    pic_idx <span class="op">=</span> <span class="dv">1</span>

    <span class="cf">if</span> <span class="op">not</span> os.path.exists(<span class="st">&#39;tea&#39;</span>):
        os.makedirs(<span class="st">&#39;tea&#39;</span>)

    <span class="cf">for</span> i <span class="op">in</span> tea_image_urls.split(<span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span>):
        <span class="cf">try</span>:
            <span class="bu">print</span>(<span class="st">&quot;.......&quot;</span>, i)
            urllib.request.urlretrieve(i, <span class="st">&quot;tea/&quot;</span><span class="op">+</span><span class="bu">str</span>(pic_idx)<span class="op">+</span><span class="st">&quot;.jpg&quot;</span>)
            pic_idx <span class="op">+=</span> <span class="dv">1</span>

        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:
            <span class="bu">print</span>(<span class="bu">str</span>(e))
        
<span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">&quot;__main__&quot;</span>: 
    save_images_from_image_net()</code></pre></div>
<h2 id="작업결과-검토">3. 작업결과 검토</h2>
<p><a href="http://image-net.org/">이미지넷</a>에 이미지 파일이 저장되어 있지만 웹서버가 수리중이거나, 이미지 파일위치가 변경되었거나, 네트워크 환경이 작업 당시 좋지 않거나 여러가지 사유로 인해 정상동작하지 않을 수 있다. 정상적으로 다운로드된 이미지 파일과 결과를 출력 로그를 통해서 확인할 수 있다. 대상 23개 이미지 중 12개만 정상 다운로드된 것을 확인할 수 있다.</p>
<pre class="output"><code>....... http://open.salon.com/files/tea_cup_small1259088246.jpg
....... http://www.teageek.net/Images/TeaTasting3.jpg
....... http://farm1.static.flickr.com/29/45497721_fb90fefa74.jpg
....... http://mortalcore.com/wp-content/uploads/2009/06/istock_000005851440xsmall-300x199.jpg
&lt;urlopen error [Errno 11001] getaddrinfo failed&gt;
....... http://c2.api.ning.com/files/ldu*IIBKr68CKtLHAYP3DpsspxMhWj-e8PIBGotCENVGjIFVF6e1yFAvqiqZhwgvwjG50f9k5n9GOUVKG4xUP8x-kidLy12V/turkish_coffee.jpg
HTTP Error 404: Not Found
....... http://www.health-outlook.com/wp-content/uploads/2009/03/tea.jpg
&lt;urlopen error [WinError 10060] 연결된 구성원으로부터 응답이 없어 연결하지 못했거나, 호스트로부터 응답이 없어 연결이 끊어졌습니다&gt;
....... http://blog.hotelclub.com/wp-content/uploads/2008/09/hot-buttered-rum.jpg
HTTP Error 503: Service Unavailable
....... http://ndn3.newsweek.com/media/14/080402_GreenTea_vl-vertical.jpg
&lt;urlopen error [Errno 11001] getaddrinfo failed&gt;
....... http://www.green-tea-expert.com/images/green-tea2.jpg
&lt;urlopen error [WinError 10060] 연결된 구성원으로부터 응답이 없어 연결하지 못했거나, 호스트로부터 응답이 없어 연결이 끊어졌습니다&gt;
....... http://www.agriculturalproductsindia.com/images/tea1.jpg
....... http://www.teaworld.co.uk/images/teaLemon123.jpg
&lt;urlopen error [WinError 10060] 연결된 구성원으로부터 응답이 없어 연결하지 못했거나, 호스트로부터 응답이 없어 연결이 끊어졌습니다&gt;
....... http://farm3.static.flickr.com/2342/2445546884_3b08d9c25a_o.jpg
....... http://farm4.static.flickr.com/3220/3105599324_0049f02d87.jpg
....... http://static.squidoo.com/resize/squidoo_images/-1/lens6175262_1249329862Mugicha.jpg
HTTP Error 404: Not Found
....... http://www.fresnodog.com/images/whitetea.jpg
....... http://thefeministbreeder.typepad.com/.a/6a00e54ed890f88833011168682476970c-200wi
HTTP Error 404: Not Found
....... http://www.theteahouse.com/topics1.jpg
HTTP Error 404: Not Found
....... http://farm4.static.flickr.com/3249/3286589010_2cbc20d1c5_o.jpg
....... http://i30.tinypic.com/117sojt.jpg
....... http://farm1.static.flickr.com/1/546852_90153feb56.jpg
....... http://teaguide.files.wordpress.com/2009/08/customblendimage.jpg
....... http://4.bp.blogspot.com/_3DCs5bz7mdM/Sm0ck3s5r5I/AAAAAAAAB4s/KjfHq35beQ0/s320/Camellia+and+teacup.jpg
HTTP Error 404: Not Found
....... http://img.tradeindia.com/fp/thumb/1/385/188.jpg
....... 
unknown url type: &#39;&#39;
....... 
unknown url type: &#39;&#39;</code></pre>
<p><img src="fig/imagenet-download.png" alt="이미지 다운로드 자동화" width="50%"></p>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="http://stackoverflow.com/questions/35959095/download-images-with-urllib">download images with urllib</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>
        </div>
      </div>
      </article>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="mailto:admin@software-carpentry.org">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
  </body>
</html>
